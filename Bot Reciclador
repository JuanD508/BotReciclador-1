import discord
from discord.ext import commands
import random

intents = discord.Intents.default()
intents.message_content = True

bot = commands.Bot(command_prefix="$", intents=intents)

@bot.event
async def on_ready():
    print(f'We have logged in as {bot.user}')
    guild = bot.guilds[0]

    if guild:

        channel = guild.system_channel

        if channel:
            await channel.send('Pon el comando "!funciones" para saber qu√© puedo hacer.')
        else:
            print("‚ùå No se pudo encontrar el canal por defecto del servidor.")
    else:
        print("‚ùå El bot no est√° conectado a ning√∫n servidor.")

@bot.command()
async def funciones(ctx):
    await ctx.send(f'Mis principales funciones pueden ser explicarte que tienes que echar en las respectivas canecas ( !caneca ), hacerte preguntas para verificar que si hayas aprendido correctamente( !trivia ) y decirte que puedes hacer con cada caneca de basura ( !que_hacer_con ).')

@bot.command()
async def caneca(ctx, *, eleccion: str = None):
    """Elige una caneca: verde, negra o blanca."""
    opciones = ["verde", "negra", "blanca"]

    if eleccion is None:
        await ctx.send("‚ùå Por favor elige entre las canecas: verde, negra o blanca.")
        return

    eleccion = eleccion.lower()

    if eleccion not in opciones:
        await ctx.send("‚ùå Por favor elige entre las canecas: verde, negra o blanca.")
        return

    resultado = None
    if eleccion == "verde":
        with open('images/CanecaV.png', 'rb') as f:
            picture = discord.File(f) 
            await ctx.send(file=picture)
        resultado = "Residuos org√°nicos aprovechables, como restos de comida, desechos agr√≠colas, restos de poda de jard√≠n, entre otros."
    elif eleccion == "negra":
        with open('images/CanecaN.png', 'rb') as f:
            picture = discord.File(f)
            await ctx.send(file=picture)
        resultado = "Residuos no aprovechables, como el papel higi√©nico, servilletas, papeles metalizados y cartones contaminados con comida."
    elif eleccion == "blanca":
        with open('images/CanecaB.png', 'rb') as f:
            picture = discord.File(f)
            await ctx.send(file=picture)
        resultado = "Residuos aprovechables como pl√°stico, vidrio, metales, papel y cart√≥n."

    await ctx.send(resultado)

@bot.command()
async def que_hacer_con(ctx, *, eleccion: str = None):
    """Elige una caneca: verde, negra o blanca."""
    opciones = ["caneca verde", "caneca negra", "caneca blanca"]

    if eleccion is None:
        await ctx.send("‚ùå Por favor elige entre: caneca verde, caneca negra o caneca blanca.")
        return

    eleccion = eleccion.lower()

    if eleccion not in opciones:
        await ctx.send("‚ùå Por favor elige entre: caneca verde, caneca negra o caneca blanca.")
        return

    resultado = None
    if eleccion == "caneca verde":
        resultado = "Con toda esta basura puedes hacer compost para tus plantas, o darsela al camion de la basura si no tienes plantas."
        with open('images/Compost.jpg', 'rb') as f:
            picture = discord.File(f)
            await ctx.send(file=picture)
        with open('images/CamionB.jpg', 'rb') as f:
            picture = discord.File(f)
            await ctx.send(file=picture)
    elif eleccion == "caneca negra":
        resultado = "Con toda esta basura puedes simplemente darsela al camion de basura, ya que tu no puedes hacer nada m√°s con esta."
        with open('images/CamionB.jpg', 'rb') as f:
            picture = discord.File(f)
            await ctx.send(file=picture)
    elif eleccion == "caneca blanca":
        resultado = "Con toda esta basura puedes hacer manualidades si te gusta, o venderla en un centro de reciclaje para conseguir un dinero extra."
        with open('images/Manualidades.webp', 'rb') as f:
            picture = discord.File(f)
            await ctx.send(file=picture)
        with open('images/CentroDeR.png', 'rb') as f:
            picture = discord.File(f)
            await ctx.send(file=picture)
    await ctx.send(resultado)

@bot.command()
async def trivia(ctx):
    preguntas = {
        "¬øEn cu√°l caneca se echan los residuos org√°nicos aprovechables?": "Caneca verde",
        "¬øEn cu√°l caneca se echan los residuos aprovechables?": "Caneca blanca",
        "¬øEn cu√°l caneca se echan los residuos no aprovechables?": "Caneca negra"
    }
    pregunta, respuesta = random.choice(list(preguntas.items()))
    await ctx.send(pregunta)

    def check(m):
        return m.author == ctx.author and m.channel == ctx.channel

    try:
        mensaje = await bot.wait_for("message", check=check, timeout=15.0)
        if mensaje.content.lower() == respuesta.lower():
            await ctx.send(f'üéâ ¬°Correcto, {ctx.author.mention}!')
        else:
            await ctx.send(f'‚ùå Incorrecto. La respuesta era {respuesta}.')
    except discord.errors.TimeoutError:
        await ctx.send(f'‚è∞ Se acab√≥ el tiempo. La respuesta era {respuesta}.')

bot.run("Tu token aqui")
